# Google Maps Platform 連携確認用 テスト計画書

このドキュメントは、実際のGoogle Maps Platform、Hotpepper APIを使用し、本番環境（またはデプロイ済みのEdge Functions）で正しく動作しているかを手動で確認するための手順書です。

**目的**:
1.  Edge Function から Google Maps API (Places, Routes) が正しく呼び出せているか確認する。
2.  課金を最低限に抑えるため、**1回だけ** 実行してログと結果で成否を判断する。

---

## 1. 事前準備 (確認)

*   [ ] **Supabase Dashboard**: 環境変数 (`GOOGLE_MAPS_API_KEY`, `HOTPEPPER_KEY`) が正しく設定されていること。
*   [ ] **Google Cloud Console**:
    *   Google Maps Platform が有効になっていること。
    *   APIキーに「Places API」と「Routes API」の権限があること。

---

## 2. テストデータの準備 (アプリ操作)

わかりやすい結果を得るため、意図的に「中間地点」が特定しやすい場所を設定します。

1.  **イベント作成**: アプリで新規イベントを作成します（例: 「APIテスト」）。
2.  **参加者登録 (2名以上)**:
    *   **ユーザーA**: 東京駅周辺 (詳細な場所にこだわりすぎなくてOK)
    *   **ユーザーB**: 横浜駅周辺
    *   *解説*: 中間として「川崎」や「品川」あたりが選ばれるのが自然です。極端に離れた場所でなければOKです。
3.  **日程入力**:
    *   両者とも「今週の金曜 19:00」などを候補日として登録してください。
    *   *解説*: 到着希望時刻 (`arrivalTime`) を特定させるためです。

---

## 3. テスト実行 (結果を見るボタン)

1.  全員の入力が終わったら、結果画面 (`/result`) に移動します。
2.  **「結果を見る」ボタン** をクリックします。
    *   この瞬間、Edge Function (`finalize-event`) が実行され、課金対象のAPIコール（Routes Matrix）が1回走ります。

---

## 4. 検証手順 (ログとコンソール)

エラーが出ずに画面に結果（開催場所とレストラン）が表示されれば概ね成功ですが、詳細を確認します。

### A. Supabase ログ確認
1.  Supabase Dashboard を開く。
2.  **Edge Functions** > **Functions** > **finalize-event** をクリック。
3.  **Logs** タブを開く。
4.  直近の実行ログを確認し、以下のような出力があるかチェックしてください：
    *   `Using Arrival Time: 202X-XX-XXT19:00:00.000Z` (日程が正しく認識されたか)
    *   （エラーが出ていないこと）例: `Routes API Error` などがないか。
    *   HTTPステータス `200 OK` で終了しているか。

### B. Google Cloud Console 確認 (APIヒット確認)
実際にAPIがGoogleのサーバーに到達したか確認します。
*注: 反映まで数分〜数十分かかる場合があります。*

1.  **Google Cloud Console** > **Google Maps Platform** > **概要 (Metrics)** を開く。
2.  **APIごとのリクエスト数** を確認:
    *   **Places API (Nearby Search)**: 1回 カウントされているはずです（駅検索）。
    *   **Routes API (Compute Route Matrix)**: 1回 カウントされているはずです（移動時間計算）。

### C. アプリ画面確認 (Hotpepper連携)
1.  画面に「開催場所: 〇〇駅」が表示されているか。
    *   東京と横浜なら、品川・川崎・新橋などが表示されていればロジックは正常です。
2.  「周辺のおすすめ飲食店」に、現実に存在するお店が表示されているか。
    *   写真、予算、キャッチコピーが表示されていれば、Hotpepper APIも正常です。

---

## 5. 合格基準

*   アプリ上でエラーにならず、妥当な駅とレストランが表示された。
*   Supabaseログにエラーがない。

これでテスト完了です。これ以上の実行は課金節約のため控えてください。
